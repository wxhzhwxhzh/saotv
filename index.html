<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SaoTV æµåª’ä½“æ’­æ”¾å™¨</title>
  <link rel="stylesheet" href="#" id="theme-stylesheet">
  <link rel="icon" href="fav.png">
  <style id="inline-styles">
    :root {
      --bg-primary: #1a1a2e;
      --bg-secondary: #16213e;
      --bg-card: #0f3460;
      --text-primary: #eaeaea;
      --text-secondary: #a0a0a0;
      --border-color: #2d3748;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
      --accent: #3498db;
      --accent-hover: #5dade2;
      --history-hover: #1a2a4e;
      --input-bg: #1e2a3a;
      --danger: #e74c3c;
      --success: #27ae60;
      --sidebar-bg: #0a1929;
      --navbar-bg: #0f1c3f;
    }

    [data-theme="light"] {
      --bg-primary: #f5f7fa;
      --bg-secondary: #ffffff;
      --bg-card: #ffffff;
      --text-primary: #2c3e50;
      --text-secondary: #7f8c8d;
      --border-color: #e1e8ed;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      --accent: #3498db;
      --accent-hover: #2980b9;
      --history-hover: #f8f9fa;
      --input-bg: #ffffff;
      --danger: #e74c3c;
      --success: #27ae60;
      --sidebar-bg: #ecf0f1;
      --navbar-bg: #f8f9fa;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      background: var(--bg-primary);
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
    }

    /* å¯¼èˆªæ æ ·å¼ */
    .navbar {
      background: var(--navbar-bg);
      padding: 12px 20px;
      border-bottom: 2px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow);
      z-index: 100;
    }

    .navbar-title {
      font-size: 1.5em;
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .navbar-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .social-link {
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
      padding: 8px 12px;
      border-radius: 6px;
      transition: all 0.3s ease;
    }

    .social-link:hover {
      color: var(--accent-hover);
      background-color: rgba(52, 152, 219, 0.1);
    }

    .content-wrapper {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    .sidebar {
      width: 280px;
      background: var(--sidebar-bg);
      padding: 20px;
      border-right: 2px solid var(--border-color);
      overflow-y: auto;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
    }

    .sidebar-title {
      font-size: 1.3em;
      font-weight: 600;
      margin-bottom: 20px;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .channel-list {
      list-style: none;
    }

    .channel-item {
      background: var(--bg-card);
      padding: 12px 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      cursor: pointer;
      border: 2px solid var(--border-color);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .channel-item:hover {
      border-color: var(--accent);
      transform: translateX(5px);
      background: var(--history-hover);
    }

    .channel-icon {
      font-size: 20px;
    }

    .channel-name {
      font-size: 14px;
      color: var(--text-primary);
      font-weight: 500;
    }

    .main-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: var(--bg-card);
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 30px;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    h1 {
      font-size: 2em;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .theme-toggle {
      background: var(--input-bg);
      border: 2px solid var(--border-color);
      padding: 10px 16px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      transform: scale(1.05);
      border-color: var(--accent);
    }

    .input-container {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    input[type="text"] {
      flex: 1;
      padding: 14px 18px;
      font-size: 15px;
      border: 2px solid var(--border-color);
      border-radius: 10px;
      background: var(--input-bg);
      color: var(--text-primary);
      transition: all 0.3s ease;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    button {
      padding: 14px 24px;
      font-size: 15px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    button:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
    }

    button:active {
      transform: translateY(0);
    }

    .btn-clear {
      background: var(--danger);
    }

    .btn-clear:hover {
      background: #c0392b;
    }

    .video-container {
      position: relative;
      margin-top: 20px;
      border-radius: 12px;
      overflow: hidden;
      background: #000;
    }

    video {
      width: 100%;
      height: auto;
      display: block;
    }

    .video-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
      padding: 15px;
      background: var(--bg-secondary);
      border-radius: 10px;
      border: 1px solid var(--border-color);
    }

    .video-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--text-secondary);
    }

    .status-dot.active {
      background: var(--success);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .history-section {
      margin-top: 40px;
    }

    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .history-title {
      font-size: 1.4em;
      color: var(--text-primary);
      font-weight: 600;
    }

    .history-list {
      list-style-type: none;
    }

    .history-list li {
      background: var(--bg-secondary);
      padding: 15px 18px;
      margin: 8px 0;
      border: 2px solid var(--border-color);
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      color: var(--text-secondary);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
    }

    .history-list li:hover {
      background: var(--history-hover);
      border-color: var(--accent);
      transform: translateX(5px);
    }

    .history-delete {
      background: transparent;
      color: var(--danger);
      padding: 5px 10px;
      font-size: 12px;
      margin: 0;
    }

    .history-delete:hover {
      background: var(--danger);
      color: white;
      transform: none;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-secondary);
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .url-text {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    @media (max-width: 968px) {
      .content-wrapper {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 2px solid var(--border-color);
      }

      .container {
        padding: 20px;
      }

      h1 {
        font-size: 1.5em;
      }

      .input-container {
        flex-direction: column;
      }

      button {
        width: 100%;
        justify-content: center;
      }

      .navbar {
        flex-direction: column;
        gap: 10px;
        padding: 15px 20px;
      }

      .navbar-title {
        font-size: 1.3em;
      }
    }
  </style>
</head>
<body>
  <!-- å¯¼èˆªæ  -->
  <nav class="navbar">
    <div class="navbar-title">
      <span>ğŸ“º</span>
      SaoTV äº’è”ç½‘åœ¨çº¿TV
    </div>
    <div class="navbar-right">
      <a href="https://iptv-org.github.io/" class="social-link" target="_blank">IPTVèµ„æº</a>
      <button class="theme-toggle" id="theme-toggle">
        <span id="theme-icon">â˜€ï¸</span>
      </button>
    </div>
  </nav>

  <div class="content-wrapper">
    <div class="sidebar">
      <div class="sidebar-title">
        <span>ğŸ“º</span>
        æ¨èé¢‘é“
      </div>
      <ul class="channel-list" id="channel-list"></ul>
    </div>

    <div class="main-content">
      <div class="container">
        <div class="header">
          <h1>
            <span>ğŸ¬</span>
            æµåª’ä½“æ’­æ”¾å™¨
          </h1>
        </div>
        
        <div class="input-container">
          <input type="text" id="m3u8-url" placeholder="è¯·è¾“å…¥ .m3u8 æˆ–è§†é¢‘é“¾æ¥" />
          <div class="controls">
            <button id="play-btn">
              <span>â–¶ï¸</span> æ’­æ”¾
            </button>
            <button class="btn-clear" id="clear-btn">
              <span>ğŸ—‘ï¸</span> æ¸…ç©º
            </button>
          </div>
        </div>

        <div class="video-container">
          <video id="video-player" controls>
            <source id="video-source" type="application/x-mpegURL">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
          </video>
        </div>

        <div class="video-info">
          <div class="video-status">
            <span class="status-dot" id="status-dot"></span>
            <span id="status-text">ç­‰å¾…æ’­æ”¾</span>
          </div>
          <div id="current-url" style="font-size: 12px; color: var(--text-secondary); max-width: 400px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"></div>
        </div>

        <div class="history-section">
          <div class="history-header">
            <div class="history-title">ğŸ“œ æ’­æ”¾å†å²</div>
            <button class="btn-clear" id="clear-history-btn" style="padding: 8px 16px; font-size: 13px;">
              æ¸…ç©ºå†å²
            </button>
          </div>
          <ul class="history-list" id="history-list"></ul>
        </div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    let currentHls = null;

    // æ¨èé¢‘é“æ•°æ®
    const channels = {
      "channels": [
        {
          "name": "BBCæ–°é—»",
          "url": "https://cdn4.skygo.mn/live/disk1/BBC_News/HLSv3-FTA/BBC_News.m3u8"
        },
        {
          "name": "BBCä¸–ç•Œ(æ¬§æ´²)",
          "url": "https://viamotionhsi.netplus.ch/live/eds/bbcworld/browser-HLS8/bbcworld.m3u8"
        },
        {
          "name": "BBCæ–°é—»(åŒ—ç¾)",
          "url": "https://fl1.moveonjoy.com/BBC_WORLD_NEWS/index.m3u8"
        },
        {
          "name": "ä¸­å›½å›½é™…TV",
          "url": "https://amg00405-rakutentv-cgtn-rakuten-i9tar.amagi.tv/master.m3u8"
        }
      ]
    };

    // åˆå§‹åŒ–é¢‘é“åˆ—è¡¨
    function initChannels() {
      const $channelList = $('#channel-list');
      $channelList.empty();

      $.each(channels.channels, function(index, channel) {
        const $channelItem = $('<li>')
          .addClass('channel-item')
          .html(`
            <span class="channel-icon">ğŸ“¡</span>
            <span class="channel-name">${channel.name}</span>
          `)
          .on('click', function() {
            playStream(channel.url);
            $('#m3u8-url').val(channel.url);
          });
        
        $channelList.append($channelItem);
      });
    }

    // ä¸»é¢˜åˆ‡æ¢
    function toggleTheme() {
      const $html = $('html');
      const currentTheme = $html.attr('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      
      $html.attr('data-theme', newTheme);
      $('#theme-icon').text(newTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸');
      
      // ä¿å­˜åˆ°localStorage
      localStorage.setItem('themePreference', newTheme);
    }

    // åŠ è½½ä¸»é¢˜è®¾ç½®
    function loadTheme() {
      const savedTheme = localStorage.getItem('themePreference') || 'dark';
      $('html').attr('data-theme', savedTheme);
      $('#theme-icon').text(savedTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸');
    }

    // åŠ è½½æ’­æ”¾å†å²
    function loadHistory() {
      const history = JSON.parse(localStorage.getItem('playHistory')) || [];
      const $historyList = $('#history-list');
      $historyList.empty();

      if (history.length === 0) {
        $historyList.html('<div class="empty-state"><div class="empty-state-icon">ğŸ“­</div><div>æš‚æ— æ’­æ”¾è®°å½•</div></div>');
        return;
      }

      $.each(history, function(index, url) {
        const $li = $('<li>')
          .html(`
            <span class="url-text" title="${url}">${url}</span>
            <button class="history-delete">åˆ é™¤</button>
          `)
          .on('click', function() {
            playStream(url);
          });

        $li.find('.history-delete').on('click', function(e) {
          e.stopPropagation();
          deleteHistoryItem(index);
        });

        $historyList.append($li);
      });
    }

    // åˆ é™¤å•ä¸ªå†å²è®°å½•
    function deleteHistoryItem(index) {
      const history = JSON.parse(localStorage.getItem('playHistory')) || [];
      history.splice(index, 1);
      localStorage.setItem('playHistory', JSON.stringify(history));
      loadHistory();
    }

    // æ¸…ç©ºå†å²
    function clearHistory() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ’­æ”¾å†å²å—ï¼Ÿ')) {
        localStorage.removeItem('playHistory');
        loadHistory();
      }
    }

    // æ¸…ç©ºè¾“å…¥æ¡†
    function clearInput() {
      $('#m3u8-url').val('').focus();
    }

    // æ›´æ–°çŠ¶æ€
    function updateStatus(status, isActive = false) {
      $('#status-text').text(status);
      if (isActive) {
        $('#status-dot').addClass('active');
      } else {
        $('#status-dot').removeClass('active');
      }
    }

    // æ’­æ”¾è§†é¢‘æµ
    function playStream(url = null) {
      const videoUrl = url || $('#m3u8-url').val().trim();
      const $videoPlayer = $('#video-player')[0];

      if (videoUrl === "") {
        alert("è¯·è¾“å…¥è§†é¢‘é“¾æ¥ï¼");
        return;
      }

      // æ¸…ç†ä¹‹å‰çš„HLSå®ä¾‹
      if (currentHls) {
        currentHls.destroy();
        currentHls = null;
      }

      updateStatus('æ­£åœ¨åŠ è½½...', false);
      $('#current-url').text(videoUrl);

      // å¦‚æœæµè§ˆå™¨æ”¯æŒ HLS.js
      if (Hls.isSupported()) {
        currentHls = new Hls();
        currentHls.loadSource(videoUrl);
        currentHls.attachMedia($videoPlayer);

        currentHls.on(Hls.Events.MANIFEST_PARSED, function () {
          console.log('æµåª’ä½“åŠ è½½æˆåŠŸï¼');
          updateStatus('æ’­æ”¾ä¸­', true);
          $videoPlayer.play();
        });

        currentHls.on(Hls.Events.ERROR, function (event, data) {
          console.error('åŠ è½½æµåª’ä½“æ—¶å‘ç”Ÿé”™è¯¯ï¼š', data);
          updateStatus('åŠ è½½å¤±è´¥', false);
          alert('åŠ è½½æµåª’ä½“æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·æ£€æŸ¥é“¾æ¥æˆ–ç½‘ç»œè¿æ¥ã€‚');
        });
      } else if ($videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
        $videoPlayer.src = videoUrl;
        $videoPlayer.load();
        $($videoPlayer).on('loadeddata', function() {
          updateStatus('æ’­æ”¾ä¸­', true);
          $videoPlayer.play();
        }).on('error', function() {
          updateStatus('åŠ è½½å¤±è´¥', false);
        });
      } else {
        updateStatus('ä¸æ”¯æŒ', false);
        alert("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ’­æ”¾è¯¥æµåª’ä½“ï¼");
      }

      updateHistory(videoUrl);
    }

    // æ›´æ–°æ’­æ”¾å†å²
    function updateHistory(url) {
      const history = JSON.parse(localStorage.getItem('playHistory')) || [];
      
      // ç§»é™¤é‡å¤çš„URL
      const index = history.indexOf(url);
      if (index > -1) {
        history.splice(index, 1);
      }
      
      history.unshift(url);
      
      if (history.length > 10) {
        history.pop();
      }
      
      localStorage.setItem('playHistory', JSON.stringify(history));
      loadHistory();
    }

    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    $(document).ready(function() {
      loadTheme();
      loadHistory();
      initChannels();

      // ç»‘å®šäº‹ä»¶
      $('#theme-toggle').on('click', toggleTheme);
      $('#play-btn').on('click', function() { playStream(); });
      $('#clear-btn').on('click', clearInput);
      $('#clear-history-btn').on('click', clearHistory);

      // æ”¯æŒå›è½¦é”®æ’­æ”¾
      $('#m3u8-url').on('keypress', function(e) {
        if (e.which === 13) {
          playStream();
        }
      });

      // ç›‘å¬è§†é¢‘æ’­æ”¾äº‹ä»¶
      const $videoPlayer = $('#video-player');
      $videoPlayer.on('play', function() { updateStatus('æ’­æ”¾ä¸­', true); });
      $videoPlayer.on('pause', function() { updateStatus('å·²æš‚åœ', false); });
      $videoPlayer.on('ended', function() { updateStatus('æ’­æ”¾å®Œæˆ', false); });
    });
  </script>

</body>
</html>